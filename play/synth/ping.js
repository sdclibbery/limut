'use strict';
define(function (require) {
  let system = require('play/system');
  let scale = require('music/scale');
  // let envelope = require('play/envelopes')
  // let effects = require('play/effects')
  // let pitchEffects = require('play/pitch-effects')
  let {evalPerEvent,evalPerFrame} = require('play/eval-audio-params')

  const bubblesDef = Uint8Array.from(
    [83, 67, 103, 102, 0, 0, 0, 1, 0, 1, 13, 65, 110, 97, 108, 111, 103, 66, 117, 98, 98, 108, 101, 115, 0, 7, 0, 0, 0, 0, 64, 64, 0, 0, 66, -96, 0, 0, 65, -64, 0, 0, 61, 35, -41, 10, 62, 76, -52, -51, 64, -128, 0, 0, 0, 3, 62, -52, -52, -51, 65, 0, 0, 0, 63, 103, 92, 41, 0, 3, 5, 102, 114, 101, 113, 49, 0, 0, 5, 102, 114, 101, 113, 50, 0, 1, 6, 100, 101, 116, 117, 110, 101, 0, 2, 0, 18, 7, 67, 111, 110, 116, 114, 111, 108, 1, 0, 0, 0, 3, 0, 0, 1, 1, 1, 5, 76, 70, 83, 97, 119, 2, 0, 2, 0, 1, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 2, 12, 66, 105, 110, 97, 114, 121, 79, 112, 85, 71, 101, 110, 1, 0, 2, 0, 1, 0, 2, 0, 0, 0, 1, 0, 0, 0, 2, 1, 5, 76, 70, 83, 97, 119, 2, 0, 2, 0, 1, 0, 0, 0, 2, 0, 0, -1, -1, 0, 0, 2, 6, 77, 117, 108, 65, 100, 100, 2, 0, 3, 0, 1, 0, 0, 0, 3, 0, 0, -1, -1, 0, 1, -1, -1, 0, 2, 2, 6, 77, 117, 108, 65, 100, 100, 2, 0, 3, 0, 1, 0, 0, 0, 1, 0, 0, -1, -1, 0, 3, 0, 4, 0, 0, 2, 11, 85, 110, 97, 114, 121, 79, 112, 85, 71, 101, 110, 2, 0, 1, 0, 1, 0, 17, 0, 5, 0, 0, 2, 6, 83, 105, 110, 79, 115, 99, 2, 0, 2, 0, 1, 0, 0, 0, 6, 0, 0, -1, -1, 0, 0, 2, 12, 66, 105, 110, 97, 114, 121, 79, 112, 85, 71, 101, 110, 2, 0, 2, 0, 1, 0, 2, 0, 7, 0, 0, -1, -1, 0, 4, 2, 5, 67, 111, 109, 98, 78, 2, 0, 4, 0, 1, 0, 0, 0, 8, 0, 0, -1, -1, 0, 5, -1, -1, 0, 5, -1, -1, 0, 6, 2, 5, 76, 70, 83, 97, 119, 2, 0, 2, 0, 1, 0, 0, 0, 0, 0, 1, -1, -1, 0, 0, 2, 6, 77, 117, 108, 65, 100, 100, 2, 0, 3, 0, 1, 0, 0, 0, 10, 0, 0, -1, -1, 0, 1, -1, -1, 0, 2, 2, 6, 77, 117, 108, 65, 100, 100, 2, 0, 3, 0, 1, 0, 0, 0, 1, 0, 0, -1, -1, 0, 3, 0, 11, 0, 0, 2, 11, 85, 110, 97, 114, 121, 79, 112, 85, 71, 101, 110, 2, 0, 1, 0, 1, 0, 17, 0, 12, 0, 0, 2, 6, 83, 105, 110, 79, 115, 99, 2, 0, 2, 0, 1, 0, 0, 0, 13, 0, 0, -1, -1, 0, 0, 2, 12, 66, 105, 110, 97, 114, 121, 79, 112, 85, 71, 101, 110, 2, 0, 2, 0, 1, 0, 2, 0, 14, 0, 0, -1, -1, 0, 4, 2, 5, 67, 111, 109, 98, 78, 2, 0, 4, 0, 1, 0, 0, 0, 15, 0, 0, -1, -1, 0, 5, -1, -1, 0, 5, -1, -1, 0, 6, 2, 3, 79, 117, 116, 2, 0, 3, 0, 0, 0, 0, -1, -1, 0, 0, 0, 16, 0, 0, 0, 9, 0, 0, 0, 0]
  )
  return (params) => {
    let degree = parseInt(params.sound) + evalPerEvent(params, 'add', 0)
    if (isNaN(degree)) { return }
    let freq = scale.degreeToFreq(degree, evalPerEvent(params, 'oct', 5), evalPerEvent(params, 'scale'))

    if (bubblesDef.done === undefined) {
console.log('initing bubbles Def')
      system.sc.sendOSC_t('/d_recv', 'b', bubblesDef)
      bubblesDef.done = true
    }
    system.sc.sendOSC_t('/g_freeAll', 'i', 0)
    system.sc.sendOSC_t('/s_new', 'siii', 'AnalogBubbles', 1000, 1, 0)
  }
})
