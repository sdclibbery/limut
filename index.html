<html>
<head>
  <title>LiMuT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8">
  <style>
    body {
      font-family: helvetica, arial;
      background: #202830;
      color: #d0d0d0;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
      scrollbar-width: thin;
      scrollbar-color: #b0b0b080 #50505080;
    }
    .fullscreen {
      position: fixed;
      top:0%;
      left:0%;
      width:100%;
      height:100%;
      z-index: -1;
    }
    .fixed-top {
      position: sticky;
      top: 0;
      left: 0;
      z-index: 999;
      width: 100%;
    }
    .widget {
      color: #d0d0d0;
      border: 2px solid #202020;
      border-radius: 6px;
      margin: 2px;
      padding: 2px;
      font-size: 1.1em;
    }
    .widget p {
      margin: 0px;
    }
    .widget h3 {
      margin: 0px;
    }
    .code {
      height: 400px;
      margin-bottom: 8px;
      max-width: 100%;
    }
    code {
      color: #d0d0ff;
    }
    textarea {
      font-size: 1.5em;
      color: #e0e0e0;
      width: 100%;
      max-width: 100%;
      background: transparent;
      border-radius: 4px;
      border-style: solid;
      border-color: #60606080;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
      caret-color: #80b0ff;
    }
    textarea::selection {
      background: #4060d0;
      color: #000000;
      text-shadow: none;
    }
    textarea#console {
      font-size: 1em;
      color: #808080;
    }
    button {
      width:1.5em;
      height:1.5em;
      background: #80808080;
      font-size: 1.3em;
      border-radius: 4px;
      border-style: solid;
      border-color: #d0d0d080;
      padding: 0;
    }
    span {
      font-weight: bold;
    }
    span.beat-readout {
      padding-left: 24px;
      font-weight: normal;
      font-family: courier, mono, monospace;
    }
    .info {
      width: 100%;
      max-width: 100%;
    }
    .closed {
      display: none;
    }
    pre {
      width: 100%;
      max-width: 100%;
      overflow-x: auto;
    }
    .sub {
      margin-top: -10px;
      margin-left: 20px;
    }
    .meter {
      display: inline-block;
      width: 1em;
      height: 1em;
      background-color: #808080;
    }
    .info h4 {
      cursor: pointer;
    }
    :fullscreen { display: flex; flex-flow: column; }
    :fullscreen > * > h3 { font-size: 1em; }
    :fullscreen > .code { flex: 1; max-height: calc(100% + 100px); }
    :fullscreen > .info { display: none; }
  </style>
  <link rel="stylesheet" href="codemirror/codemirror.css">
  <script src="codemirror/codemirror.js"></script>
  <script src="codemirror/mode.js"></script>
  <script src="codemirror/comment.js"></script>
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-13034280-3', { 'storage': 'none' }); // No cookies
    ga('send', 'pageview');
  </script>
  <!-- End Google Analytics -->
</head>
<body>
  <canvas id="canvas" class="fullscreen" style="width:100%; height:100%; background: #000f; display:none"></canvas>
  <div class="widget">
    <h3>Limut live coding</h3>
    <p>
      <input id="main-amp-slider" type="range" min="0" max="200" oninput="mainAmpChange(parseFloat(this.value)/100)" style="width:100%;" />
    </p>
    <p>
      Beat: <span class="beat-readout" id="beat-readout"></span>
      <span class="beat-readout">:</span>
      <span class="beat-readout" id="beat1-readout"></span>
      <span class="beat-readout" id="beat2-readout"></span>
      <span class="beat-readout" id="beat3-readout"></span>
    </p>
    <p id="sliders">
      <template id="slider-template">
        <p style="display: flex; flex-flow: row nowrap;">
          <span class="slider-name"></span>
          <input class="slider" type="range" min="0" max="1000" style="flex:auto;"/>
        </p>
      </template>
    </p>
  </div>
  <div class="widget fixed-top">
    <button onclick="go()" title="Run the code Ctrl-Enter">▶</button>
    <button onclick="stop()" title="Stop all players Ctrl-.">◼</button>
    <button onclick="comment()" title="Toggle comment for line Ctrl-/">//</button>
    <button onclick="fullscreen()" title="Toggle fullscreen">⛶</button>
    Audio: <span id="beat-latency-readout", class="meter"> </span>
    Visual: <span id="visual-readout", class="meter"> </span>
    Compression: <span id="compressor-readout", class="meter"> </span>
  </div>
  <div id="code-codemirror" class="widget code" style="display:none;"></div>
  <textarea id="code-textarea" class="widget code" rows="15" style="display:none;"></textarea>
  <textarea id="console" class="widget" rows="5"></textarea>
</div>
<div class="info">
<h4 onclick="toggleAccordion('accordion-examples')">▶ Examples</h4>
<div id="accordion-examples" class="closed">
<pre>d1 play x-o-</pre>
<pre>p1 dsaw 0534, add=(0,2,4), dur=4</pre>
<pre>Ba dbass 0, dur=1/4, add=[0:2]r*2, lpf={[3:12]r*100,q:8}, att=0</pre>
<pre>d dsaw 4[32]<01>__.., phaser=1/2, rel=2, amp=2, room={1.2,mix:1/3}</pre>
<pre>ARP dsaw 02479742, dur=1/4, lpf={100*[3,30]l6.8,q:8}, Oct=(3,5), echo=3/8, att=0
Bass prophet -2210, dur=4, Oct=(2,3), amp=1.7</pre>
<pre>chords = [0,2,-2,3]t8
p1 dbass 0-100, dur=1, chop={[2,2.5,3]t1,wave:'square'}, add=chords, echo=(1/17,1/23), amp=2
k play X., lpf=800
s play ..*.
hh play -., echo=1/4, amp=2
arp ping 04794697, dur=1/4, echo=3/8, add=chords, lpf=[10000,1000]t[24,8], amp=2/3
main dsaw 0, dur=8, add=chords, detune=(0,0.1,0.3), chop={[0,2,3]t32,wave:'square'}, amp=0.6
</pre>
<pre>d play x.h[.x]x[x.]h.
chords=[0,2,4,3]t[16,8,4,4]
be bell 0[.......2], dur=8, add=chords
gl glock 024797.., dur=1/4, add=chords</pre>
<pre>Perc play lstig, dur=[1,3,2], amp=0.5, echo=1/8
Amb dsine 0[21]., dur=4, release=8, detune=[(0,0.3,0.5,0.9),(0,0.5,0.7,1.1)]t4
Bass dbass 0, dur=8, att=2, rel=4, lpf=100*[3,30]l16@f</pre>
<pre>Prog=[2,5,4,0]t8
Ba piano 0__2, add=prog, amp=4, Oct=2
Ch piano 0, dur=8, Sus=12, add=(prog+(0,2,4))%7, amp=2, Oct=3
Le piano 0_.[.0]2343, amp=3, add=prog, Oct=4</pre>
<pre>scale=minor
Ba dbass 0.4[21], dur=4, amp=1.5, room=0.7
Kd play x[.x]x., dur=2, room=0.7
Sn play .o, dur=2, room=0.7</pre>
<pre>V lines 0, pulse=3
Scale=phrygian
Kd play X.:X.:X., Sample=2
HH play [--], amp=2
Db dbass .0_..0_1, drive=1, lpf={[1200,200]e,q:15}</pre>
<pre>bpm=120
scale=minor
k play Xv, room=1/4
h play s-s--s--, dur=1/4
c play ..(H*)., room=1/4
ba saw 020.00.0.040.00., dur=1/4, oct=2, sus=1/6, amp=2, lpf=this.freq*[[3:20]l7,2]e, room={1,mix:1/4}</pre>
<pre>bpm=65
pad dsaw (024)(025)(035)(026), envelope=pad, dur=4, lpf=[600:3000]s21, oct=3, amp=[1.2:2.0]s70
padf ethereal follow pad, oct=4
pi ping 0, dur=[3,3,2]/20, amp=[]n*[2.0:0]s96, oct=[3,4,5,6]t1/4, add=[0,5,3,4]t4+[0,[1:3]n32,4,[6:10]n37]r, sus=2, addc=[-.15:.15]n</pre>
<pre>v kal 0, tunnel, scroll={x:time/8}, monochrome, fore=rainbow, mid=white</pre>
<pre>bpm=145
scale=minor
v streetlight 0
kd play (xv):, lpf=1000
hh play -, dur=1/4, amp=[0.2:1.2]n
kk play ::[::][::][::]::., lpf=[600:900]l40, rate=[0.8:1.2]n
ba dbass 0, dur=1/4, att=0, lpf=[1000:100]e, hpf=[0:500]n
pi ping [010], add=[-5:5]l18/4, amp=[0:[0:1]t96]n, echo=1/2, oct=6, scale=minorpentatonic
pad dsaw (-303), dur=16, envelope=pad, amp=[0:1]s64@f, room=0.5, lpf=[1000:3000]s32@f, oct=3, addc=[2,2,0,0]s[62,4,62,0]@f</pre>
<pre>bpm=90
n noise 00, dur=[9,7], envelope=simple, bpf=523*[[1:5]e,[1:1/5]e]*[1:[1.1,1.25]]n1, amp=3/2, att=[2,1/4], rel=[9,7], pan=[-1,1]l8@f
p dsaw 0., dur=[3,1,5,3,3,4], addc=[1:3]r+[2,0]e, envelope=simple, att=0.1, rel=[0.4:0.6]r, oct=6, pan=[-1:1]n8, amp=[0.3:1.1]n8, room=1
</pre>
<pre>s supersaw 0, dur=[1/4:1]l8, scale=penta, add=[-10:10]r1/2, room=2, lpf={[300,3000,300]e,q:11}, amp=2, phaser=1/4
</pre>
</div>
<h4 onclick="toggleAccordion('accordion-indicators')">▶ Indicators</h4>
<div id="accordion-indicators" class="closed">
  <p><b>Beat</b> Current audio system beat count, followed by beat counts out of 12, 16 and 32 beats (useful for synchronising changes to various size musical bars and progressions)</p>
  <p><b>Audio</b> Audio lag; green when the browser audio system is keeping up; turns red when the system is struggling, which may lead to audio glitching</p>
  <p><b>Visual</b> Visual lag; green when the framerate is keeping up to 60 fps; turns red when the system is struggling, which may lead to visual glitching</p>
  <p><b>Compression</b> Audio compression: turns red when the Limut compressor is active, implying the combined audio sources are too loud. Note there may be another, separate compressor in the browser and/or operating system. The Volume slider and <code>main.amp</code> control follow <i>after</i> this compressor.</p>
</div>
<h4 onclick="toggleAccordion('accordion-basic-syntax')">▶ Basic Syntax</h4>
<div id="accordion-basic-syntax" class="closed">
<p>Limut is case insensitive; <code>piano</code>, <code>Piano</code>, and <code>PIANO</code> are all treated the same; <code>[1:4]t4</code> is the same as <code>[1:4]T4</code> etc.</p>
<p>Comments: Anything after <code>//</code> on a line is ignored</p>
<p>Also, commands (eg defining a player) cannot be split over multiple lines; there must not be line breaks within a command.</p>
<p>Lines: Each command must be on a single line with no line breaks, unless "<code> \</code>" is used at the end of a line to continue the command onto the next line.</p>
<h5>Defining a player</h5>
<p>Basic structure: <code>id synth pattern, params</code></p>
<p><code>id</code> Identifier for the player, so it can be referred to from other players etc.</p>
<p><code>synth</code> Name of the audio or visual synth to use; eg <code>piano</code></p>
<p><code>pattern</code> Pattern of notes to play. Specifies the notes or sounds to play, and when to play them</p>
<p><code>params</code> Comma separated list of params (eg <code>amp=1/2</code>) that affect how the player plays; see 'Value Syntax' and 'Params' sections below</p>
<h5>Overriding player params:</h5>
<p>Basic structure: <code>set id params</code></p>
<p><code>id</code> Player identifier; the override params will be apllied to this player. Can also be a list of multiple players to apply the params to; eg <code>set [kd,sd] amp=0</code></p>
<p><code>params</code> Comma separated list of params (eg <code>amp=1/2</code>) that affect how the player plays; see 'Value Syntax' and 'Params' sections below</p>
<h5>Setting global vars:</h5>
<p>Basic structure: <code>var = value</code></p>
<p><code>var</code> variable to set; either a predefined var (see 'Predefined Vars' section below) or a user defined var which can be referenced from params on any player(s)</p>
<p><code>value</code> expression value to set; see 'Value Syntax'</p>
</div>
<h4 onclick="toggleAccordion('accordion-pattern-syntax')">▶ Pattern Syntax</h4>
<div id="accordion-pattern-syntax" class="closed">
<p><code>x-o-</code> Sequence of events, each of duration <code>dur</code>, for use with <code>play</code></p>
<p><code>0123</code> Sequence of events, each of duration <code>dur</code>, for use with tonal synths. Numbers are scale degrees</p>
<p><code>0-1-2-3</code> Negative scale degrees allow tones below the synth root pitch</p>
<p><code>x.</code> Use a dot for a rest</p>
<p><code>0#</code> # following numeric event makes it a sharp</p>
<p><code>0b</code> b following numeric event makes it a flat</p>
<p><code>0=</code> = following numeric event extends the duration by 50%</p>
<p><code>0!</code> ! following numeric event shortens the duration by 50%</p>
<p><code>0^</code> ^ following numeric event makes it 50% louder</p>
<p><code>0v</code> v following numeric event makes it 50% quieter</p>
<p><code>x^</code> ^ following non-numeric event makes it 50% louder (for use with play synth)</p>
<p><code>0_[_1]</code> Use underscore to extend the previous note duration</p>
<p><code>0[123]</code> Square brackets to fit multiple events into one <code>dur</code> (triplet shown)</p>
<p><code>0(135)</code> Round brackets to play multiple events together (i.e. a chord)</p>
<p><code>0&lt;12&gt;</code> Angle brackets to play events in sequence as the pattern repeats. Eg <code>0&lt;12&gt;</code> is exactly equivalent to <code>0102</code></p>
<p><code>follow p1</code> Use <code>follow</code> to follow another player (named 'p1' in the example) pattern</p>
</div>
<h4 onclick="toggleAccordion('accordion-value-syntax')">▶ Value Syntax</h4>
<div id="accordion-value-syntax" class="closed">
<p>Basic structure <code>value{modifiers}@interval</code></p>
<p><code>value</code> Actual value (which may include subparameters); see below</p>
<p><code>{modifiers}</code> Map of modifiers. Modifiers may modify the time passed to the value expression, or the value it returns, or provide additional data for a parameter. For example, <code>[1,2,3]t1{0:0,per:8}</code> will give a sequence that repeats every 8 beats, forced to the value 0 at the start of each repeat.</p>
<p><code>@interval</code> Intervals specify how often the value should be evaluated, for example once per event (then the same value through the event), or continuously varying.</p>
<h5>Values:</h5>
<p><code>1</code> Single, constant value</p>
<p><code></code> No value: set param to <code>1</code>. Eg <code>monochrome</code> is the same as <code>monochrome=1</code></p>
<p><code>(1,2)</code> Multiple values, all played together</p>
<p><code>(1,2)[0]</code> Multiple values, with an index lookup to select one (or more). <code>(1,2)[0]</code> will always give <code>1</code> (the indexing is zero based). <code>(1,2,3,4)[1,2]</code> will give <code>(2,3)</code>. The index may be an expression.</p>
<p><code>[1,2]</code> Sequence of values, one per event in the pattern; for single length patterns only, all values will be expanded, so <code>p ping 0, add=[0,1,2]</code> will cycle through all three values.</p>
<p><code>[1,2]t3</code> Timed sequence, each value lasts for 3 beats</p>
<p><code>[1,2]t[12,4]</code> Timed sequence with one timing per value</p>
<p><code>[1,2]l3</code> Timed linear interpolated sequence, each value takes 3 beats to change into the next</p>
<p><code>[1,2]l[14,2]</code> Timed linear interpolated sequence, one timing per value</p>
<p><code>[1,2]s3</code> Timed smooth interpolated sequence, each value takes 3 beats to change into the next, using an 's' shaped eas in/out curve</p>
<p><code>[1,2]s[14,2]</code> Timed smooth interpolated sequence, one timing per value</p>
<p><code>[1,2]e</code> Timed smooth interpolated sequence, each value is evenly spaced from beginning to end of the current event</p>
<p><code>[]r</code> Select a different value every time, chosen randomly between 0 and 1</p>
<p><code>[1,4,7]r</code> Select a different value every time, chosen randomly from the numbers 1, 4 and 7</p>
<p><code>[:9]r</code> Select a different random float every time, between 0 and 9</p>
<p><code>[0:9]r</code> Select a different random float every time, between 0 and 9. Note if this will be rounded to to an integer (eg for oct, add or sample params), then the upper limit is exclusive. eg <code>oct=[2:3]r</code> will give a float value between 2 and 2.9999...., so since oct rounds down to the nearest integer, it will always get <code>oct=2</code></p>
<p><code>[1,2]r4</code> Select a different value and hold for 4 beats, chosen randomly from the numbers 1, 2</p>
<p><code>[1:3]r{seed:1,per:4}</code> Select a different determninistic random float every time, between 1 and 3; <code>seed</code> determines the random sequence; the sequence repeats every <code>per</code> beats. <code>seed</code> is also in beats, so adding 1 to seed pushes the sequence by 1 beat.</p>
<p><code>[]n</code> Smoothly varying noise, moving between 0 and 1</p>
<p><code>[1:2]n</code> Smoothly varying noise, moving between 1 and 2</p>
<p><code>[1:2]n4</code> Smoothly varying noise, moving between 1 and 2, taking 4 beats to progress from one value to another</p>
<p><code>[]n{seed:1,per:4}</code> Smoothly varying deterministic noise, moving between 0 and 1; <code>seed</code> and <code>per</code> work the same as for <code>[]r</code></p>
<p><code>+</code> Add values together; eg [2,3]+4 is equivalent to [6,7]</p>
<p><code>-</code> Subtract values; eg [2,3]-1 is equivalent to [1,2]</p>
<p><code>-</code> Unary minus operator; eg <code>-[1,2]</code> is equivalent to <code>[-1,-2]</code></p>
<p><code>/</code> Divide values; eg 1/2</p>
<p><code>*</code> Multiply values; eg lpf=[1,2,3]*1000</p>
<p><code>%</code> Take remainder; eg (0,4,7,9)%7 is equivalent to (0,4,0,2)</p>
<p><code>^</code> Raise to the power; eg <code>2^3</code> is 8. Imaginary results return 0; eg <code>-1^1/2</code> returns 0.</p>
<p><code>{x:0,y:1}</code> Map, containing keys and values</p>
<p><code>{2,y:1}</code> Map, containing keys and values, with a 'default' value of 2. The default value is used for some parameters; eg <code>chop={2,wave:triangle}</code> is the same as <code>chop=2</code>, but also supplies an additional 'wave' subparameter.</p>
<p><code>#246f</code> Colour value which becomes the colour map <code>{r:2/16,g:4/16,b:6/16,a:1}</code></p>
<p><code>#204060ff</code> Colour value which becomes the colour map <code>{r:2/16,g:4/16,b:6/16,a:1}</code></p>
<p><code>'abc'</code> String value</p>
<p><code>foo</code> Lookup a global var named <code>foo</code>.</p>
<p><code>foo[0]</code> Lookup a global var named <code>foo</code>, and if it contains a tuple, extract the first element only from it.</p>
<p><code>foo[0,2]</code> Lookup a global var named <code>foo</code>, and if it contains a tuple, extract the first and third elements only from it.</p>
<p><code>foo[0:2]</code> Lookup a global var named <code>foo</code>, and if it contains a tuple, extract the first to the third elements only from it.</p>
<p><code>foo{x:2}</code> Lookup a global var named <code>foo</code>, and call it as a function passing in named parameters.</p>
<p><code>p1.amp</code> Lookup the value of param <code>amp</code> from player <code>p1</code>. Uses the param from the most recently played event on that player. Can additionally use a <code>pulse</code> param on the player, which pulses from 0 to 1 as events play on that player.</p>
<p><code>p1.amp[0]</code> Lookup a global var named <code>foo</code>, and if it contains a tuple, extract the first element only from it.</p>
<p><code>this.value</code> Get param <code>value</code> from the current event.</p>
<h5>Modifiers:</h5>
<p><code>{per:8}</code> Repeat a sequence <code>[1,2,3]t1{per:8}</code> will give a sequence that repeats every 8 beats.</p>
<p><code>{per:8,0:7,2:3}</code> Force the value to evaluate to 7 at the start of each repeat, and 3 on the second beat of every repeat. Note this only works if <code>per</code> is used to make a repeating sequence.</p>
<h5>Intervals:</h5>
<p><code>@e</code> Use <code>@e</code> to evaluate this value once per event</p>
<p><code>@f</code> Use <code>@f</code> to evaluate once per frame (60 times a second). For example <code>lpf=[300:3000]l8@f</code> will update the lpf cutoff frequency continuously, while <code>lpf=[300:3000]l8</code> will be evaluated only once for each event played.</p>
</div>
<h4 onclick="toggleAccordion('accordion-audio-synths')">▶ Audio Synths</h4>
<div id="accordion-audio-synths" class="closed">
<p><code>! / stop / none</code> </p>
<p><code>play</code> Play samples. Use letters, symbols and digits 1-4 in the pattern to choose the sample (see below for full list). Note duration defaults to 1/2.</p>
<p><code>sample</code> Pitched sample player. Use the 'sample' param, and then use it as a piched synth</p>
<p><code>saw</code> Sawtooth wave</p>
<p><code>sine</code> Sine wave</p>
<p><code>square</code> Square wave</p>
<p><code>tri</code> Triangle wave</p>
<p><code>pulse</code> Pulse wave</p>
<p><code>wave</code> Synthesizer using a waveform specified by the <code>wave</code> param. Possible values <code>saw, square, sine, triangle, pulse</code></p>
<p><code>dwave</code> Synthesizer using multiple detuned waveforms specified by the <code>wave</code> param. Possible values <code>saw, square, sine, triangle, pulse</code></p>
<p><code>dsaw</code> Detuned saw - multiple sawtooth waves slightly out of tune for a fuller sound</p>
<p><code>dsquare</code> Detuned square - multiple square waves slightly out of tune for a fuller sound</p>
<p><code>dsine</code> Detuned sine pad - multiple sine waves slightly out of tune for a fuller sound</p>
<p><code>dtri</code> Detuned tri - multiple triangle waves slightly out of tune for a fuller sound</p>
<p><code>dbass</code> Detuned saw bass - multiple sawtooth waves slightly out of tune for a fuller sound</p>
<p><code>fmbass</code> Funky FM bass</p>
<p><code>ping</code> Sine wave ping</p>
<p><code>swell</code> Swell pad - triangle wave</p>
<p><code>bell</code> FM generated bell</p>
<p><code>glock</code> FM generated glockenspiel</p>
<p><code>glass</code> FM glass synth with a chiming sound</p>
<p><code>xylo</code> FM xylophone</p>
<p><code>piano</code> Sampled piano</p>
<p><code>ambi</code> Ambient drone; multiple sines with varying detunes</p>
<p><code>ethereal</code> FM Ethereal pad</p>
<p><code>noise</code> Noise pad. Note pattern value is not used; white noise is produced for all values (uses AudioWorklet so will use more audio render capacity than other synth types).</p>
<p><code>prophet</code> Prophet style pulse wave with lfo controlled pulse-width (uses AudioWorklet so will use more audio render capacity than other synth types)</p>
<p><code>supersaw</code> supersaw lead synth; 7 detuned saws</p>
<p><code>external</code> take audio from microphone or line in. Use the <code>track</code> param to specify the track within the stream.</p>
</div>
<h4 onclick="toggleAccordion('accordion-visual-synths')">▶ Visual Synths</h4>
<div id="accordion-visual-synths" class="closed">
<p><code>! / stop / none</code> </p>
<p><code>clouds</code> Moving clouds</p>
<p><code>kal</code> Changing kaleidoscope pattern</p>
<p><code>swirl</code> Psychedelic swirl</p>
<p><code>julia</code> Julia set fractal</p>
<p><code>lines</code> Twisting lines</p>
<p><code>blob</code> Morphing 3D blob</p>
<p><code>streetlight</code> Looking up at the passing streetlights on a night drive</p>
<p><code>grid</code> Square grid</p>
<p><code>glow</code> Additive glow for lights, sparks etc</p>
<p><code>stars</code> Exploding stars for fireworks etc</p>
<p><code>bits</code> Bitwise operations giving fractal patterns</p>
<p><code>gradient</code> Simple gradient in the y direction</p>
<p><code>shadertoy</code> Display a shadertoy synth. Use the <code>id</code> param to specify which shader. Only shaders published with the 'public+api' option are available, others will give error 'Shader not found'. At present, shaders that use textures or multiple channels will also not work.</p>
<p><code>image</code> Display an online image. Use the <code>url</code> param to specify the image url. The image must be served using CORS. by default the image <code>back</code> is transparent.</p>
<p><code>webcam</code> Display video feed from the attached webcam (if present). The browser will ask permission before allowing access to the webcam.</p>
<p><code>text</code> Draw and display text. Use the text param; eg <code>text='Hello'</code>. Use <code>\n</code> to split to multiple lines: <code>text='Hello\nWorld'</code>. Use subparams to control the text rendering, eg: <code>text={'Hello',font:'times',size:'144',linesize:0.7,y:1/4,x:2/3,style:'bold italic'}</code>. Text is evaluated only per event, not per frame.</p>
</div>
<h4 onclick="toggleAccordion('accordion-event-params')">▶ Common Event Params</h4>
<div id="accordion-event-params" class="closed">
<p><code>dur</code> Event time in beats</p>
<p><code>delay</code> Event start time offset in beats</p>
<p><code>amp</code> Player amplitude control</p>
<p><code>att</code> Attack time in beats</p>
<p><code>dec</code> Decay time in beats</p>
<p><code>sus</code> Sustain time in beats. Note the 'sustain' in an ADSR envelope sets the sustain level, however this param sets the sustain time. The default is time required after attack and decay to take the note to the end of the duration.</p>
<p class='sub'><code>sus={level:1/6}</code> Set the amplitude level for sustain. Note the 'sustain' in an ADSR envelope is the level, so it is this value not the main 'sus' value (which is actually the sustain time). Default: 0.8.</p>
<p><code>rel</code> Release time in beats</p>
<p><code>rate</code> Playback rate for 'play' samples, animation rate for visuals</p>
</div>
<h4 onclick="toggleAccordion('accordion-audio-params')">▶ Audio Params</h4>
<div id="accordion-audio-params" class="closed">
<p><code>add</code> Amount to add onto event scale degree, in degrees. Evaluated per event only.</p>
<p><code>addc</code> Amount to add onto event pitch, in semitones. Evaluated per frame, and accepts fractional values, so <code>addc=[0:12]e</code> will slide the note from the starting pitch smoothly up a whole octave over the course of the note.</p>
<p><code>oct</code> Octave; middle C is in octave 4</p>
<p><code>envelope</code> Specify the envelope type to use: 'full' (ADSR), 'simple' (AD), 'pad' (uses a sine roll on/off so consecutive notes maintain constant volume)</p>
<p><code>detune</code> Amount of detune in semitones</p>
<p><code>lpf</code> Low pass filter frequency in Hertz</p>
<p class='sub'><code>lpf={400,q:20}</code> Low pass filter resonance. 10 is approximately the transition where resonance starts to kick in. Default: 5.</p>
<p><code>hpf</code> High pass filter frequency in Hertz</p>
<p class='sub'><code>hpf={400,q:20}</code> High pass filter resonance. Default: 5.</p>
<p><code>bpf</code> Band pass filter frequency in Hertz</p>
<p class='sub'><code>bpf={400,q:20}</code> Band pass filter resonance. Default: 1.</p>
<p><code>nf</code> Notch filter frequency in Hertz</p>
<p class='sub'><code>nf={400,q:20}</code> Notch filter resonance. Default: 1.</p>
<p><code>low</code> Low shelf gain in decibels. Use negative values to cut frequencies below the cutoff, positive to boost them.</p>
<p class='sub'><code>low={-8,freq:400}</code> Low shelf cutoff frequency. Default: 200Hz</p>
<p><code>mid</code> Mid gain in decibels. Use negative values to cut frequencies around the cutoff, positive to boost them.</p>
<p class='sub'><code>mid={-8,freq:400}</code> Mid cutoff frequency. Default: 600Hz</p>
<p class='sub'><code>mid={-8,q:10}</code> Mid q defines the width of the mid frequency band; low q is wide. Default: 5</p>
<p><code>high</code> High shelf gain in decibels. Use negative values to cut frequencies above the cutoff, positive to boost them.</p>
<p class='sub'><code>high={-8,freq:400}</code> High shelf cutoff frequency. Default: 1100Hz</p>
<p><code>chop</code> Chop the signal into a number of parts per beat, eg <code>chop=2</code> chops the signal twice per beat. Subparam for waveform; eg <code>chop={2,wave:triangle}</code> chops twice per beat with a triangle waveform. The default waveform is sine; the options are sine, square, triangle, saw.</p>
<p class='sub'><code>chop={4,mix:1/4}</code> Mix subparam controls dry/wet mix. 0 for dry only, 1 for wet only. default: 1</p>
<p><code>ring</code> Apply ring modulation at the given frequency in Hertz, eg <code>ring=32</code> apply ring modulation at 32Hz. Subparam for waveform; eg <code>ring={32,wave:saw}</code> 32Hz ring modulation with a triangle waveform. The default waveform is triangle; the options are sine, square, triangle, saw.</p>
<p class='sub'><code>ring={32,mix:1/4}</code> Mix subparam controls dry/wet mix. 0 for dry only, 1 for wet only. default: 1</p>
<p><code>sample</code> With 'play' synth: number: choose which sample set to use. With 'sample' synth: string: url of online audio file to play (note: server must support cross origin requests for the file)</p>
<p class='sub'><code>sample={32,pitch:261.6}</code> Specify the original pitch of the sample in Hz (eg default is 261.6 Hz for C4)</p>
<p><code>noisify</code> noisify: distort the signal into noise</p>
<p><code>fold</code> distort the signal by boosting then folding the overdriven part of the waveform</p>
<p><code>clip</code> boost the signal then apply hard clipping</p>
<p><code>drive</code> overdrive by boosting the signal then applying soft clipping</p>
<p><code>bits</code> bit crush effect; value is number of bits. 1 bit is very distorted to (eg) 32 bits is relatively clean. 0 disables the effect.</p>
<p><code>scale</code> override scale for this player; set to a string eg <code>'penta'</code> or <code>'minor'</code></p>
<p><code>vib</code> vibrato frequency in cycles per beat</p>
<p class='sub'><code>vib={2,depth:1}</code> vibrato depth in semitones (default 0.4)</p>
<p class='sub'><code>vib={2,delay:1}</code> delay before vibrato starts in beats (default 1/2)</p>
<p><code>lfo</code> lfo frequency in cycles per beat for synths that use an lfo</p>
<p><code>pan</code> pan from -1 (left) to 1 (right). default: 0</p>
<p><code>echo</code> Echo time delay in beats</p>
<p class='sub'><code>echo={1,feedback:0.8}</code> Echo feedback gain, 0 to 1, default 0.35. Higher value means the echo persists for longer.</p>
<p><code>chorus</code> lfo-delay based stereo chorus effect.</p>
<p class='sub'><code>chorus={1,mix:1/4}</code> Mix subparam controls dry/wet mix. 0 for dry only, 1 for wet only. default: 1</p>
<p><code>phaser</code> LFO frequency for phaser effect, in phase sweep cycles per beat.</p>
<p class='sub'><code>phaser={1/3,mix:1/4}</code> Mix subparam controls dry/wet mix. 0 for dry only, 1 for wet only. default: 1</p>
<p><code>room</code> reverb room size (using freeverb).</p>
<p class='sub'><code>room={2,mix:1/4}</code> Mix subparam controls dry/wet mix. 0 for dry only, 1 for wet only. default: 1/2</p>
<p><code>freq</code> READ ONLY param. This param is set by all tonal synths, to the frequency in Hz of the note being played. This value can then be read for other purposes; eg <code>lpf=this.freq*2</code> will set the low pass cutoff frequency to double the note frequency.</p>
</div>
<h4 onclick="toggleAccordion('accordion-visual-params')">▶ Visual Params</h4>
<div id="accordion-visual-params" class="closed">
<p><code>add</code> Amount to add onto pattern value</p>
<p><code>zorder</code> order in which to draw visual synths; defaults to the 1/1000th of the source code line number for the player, so that visuals draw strictly in the order they appear in the source code; however, this param can be used to override this and force specific visuals to the front or rear of the draw order.</p>
<p><code>fade</code> brightness/transparent fadeout</p>
<p><code>time</code> time value to use in the shader. If this is set, the <code>rate</code> and <code>sway</code> params have no effect</p>
<p><code>rate</code> the rate that time should progress in the shader. If the <code>time</code> param is set, this has no effect</p>
<p><code>pulse</code> extent to which the audio signal affects the value passed to visual synths</p>
<p><code>sway</code> extent to which the audio signal affects the time passed to visual synths</p>
<p><code>loc</code> position and size. The visual coordinate system runs from (-1,-1) in the bottom left of the screen to (1,1) in the top right. x and y define the centre of the visual, and w and h are the full width and height; eg <code>{x:0,y:0,w:2,h:2}</code> covers the full screen.</p>
<p><code>window</code> display the only part of the shader image appropriate to the location of the tile on the screen. This way, a tile moved around the screen will act like a window onto the overall shader image.</p>
<p><code>scroll</code> scroll the shader; default: <code>{x:0,y:0}</code></p>
<p><code>zoom</code> zoom the shader; default: <code>{x:1,y:1}</code></p>
<p><code>rotate</code> rotate the shader; angle in full rotations so 1/2 is 180 degrees; default: <code>0</code></p>
<p><code>mirror</code> mirror the shader; number of mirror planes to apply; default: <code>0</code></p>
<p><code>fore</code> foreground colour; eg <code>{r:0,g:1,b:0,a:1}</code> for green or <code>#fa0f</code> for orange.</p>
<p><code>mid</code> middleground colour; eg <code>{r:0,g:1,b:0,a:1}</code> for green or <code>#fa0f</code> for orange. If not specified, defaults to midway between fore and back.</p>
<p><code>back</code> background colour; eg <code>{r:0,g:1,b:0,a:1}</code> for green or <code>#00ff</code> for orange.</p>
<p><code>pixellate</code> number of pixels to pixellate to in each direction, or 0 to disable pixellation</p>
<p><code>perspective</code> perspective warp to apply to shader (negative to invert), or 0 to disable</p>
<p><code>tunnel</code> tunnel warp to apply to shader, or 0 to disable. Applies a slitscan type warp, where scrolling in the x direction will scroll the original shader through the tunnel.</p>
<p><code>ripple</code> Apply a ripple warp to the shader, to give the effect of waves of image distortion rippling out from the centre of the shader.</p>
<p><code>additive</code> add this shaders output to those beneath instead of blending</p>
<p><code>blend</code> set the blend mode which defines how this shaders output interacts with the color already present underneath. Possible values: <code>'additive' 'subtractive' 'average' 'multiply' 'invert' 'min' 'max'</code></p>
<p><code>monochrome</code> make the shader output monochrome; 0 for normal, 1 for monochrome</p>
<p><code>vignette</code> fade out the visual around the edges. The value controls the shape.</p>
<p><code>recol</code> recolour the shader. Set to <code>oil</code> for oil film colours, or <code>hue</code> for a hue spectrum</p>
<p><code>contrast</code> apply a power based contrast curve. Default is zero meaning no contrast curve applied.</p>
</div>
<h4 onclick="toggleAccordion('accordion-predefined-vars')">▶ Predefined Vars</h4>
<div id="accordion-predefined-vars" class="closed">
<p><code>bpm</code> Beats per minute. Value resets unless set every time the code is updated.</p>
<p><code>time</code> Time, counted in beats (including fractions of a beat)</p>
<p><code>pulse</code> The current musical pulse; like a VU meter</p>
<p><code>main.amp</code> Main mix amplitude control. Value resets unless set every time the code is updated.</p>
<p><code>main.reverb</code> Main reverb amplitude control. Value resets unless set every time the code is updated.</p>
<p><code>main.clear</code> Main visual buffer clear control. Set to zero to disable clear. This may not have any visual effect on most browsers. Value resets unless set every time the code is updated.</p>
<p><code>beat.readouts</code> Set the beat counts to use for the readouts; eg <code>beat.readouts=(3,12)</code> will show two beat counters, one that counts in 3's (for a waltz), and another that counts to 12 (for 4 bars of a waltz). There cannot be more than 3 readouts. The default is <code>[12,16,32]</code></p>
<p><code>root</code> Main root pitch offset; default <code>0</code> roots the pitches on middle c; <code>1</code> pitches up by one semitone etc. This is fractional, so can be used to 'nudge' the tuning to match other instruments; eg <code>root=0.135</code> </p>
<p><code>scale</code> Scale eg minor, major, chromatic, majorpentatonic, lydian etc etc. Value resets unless set every time the code is updated.</p>
<p><code>drop6_2</code> Predefined time var: equivalent to <code>[1,0]t[6.2]</code>. These are all the predefined drops: drop6_2, drop7_1, drop12_4, drop14_2, drop15_1, drop24_8, drop28_4, drop30_2, drop31_1, drop56_8, drop60_4, drop62_2, drop63_1</p>
<p><code>tile_full</code> Predefined loc param map to cover the full screen: equivalent to <code>{x:0,y:0,w:1,h:1}</code>. Other predefined locations: tile_tl/tr/bl/br/m, tile_h1/2/3/4/5, tile_v1/2/3/4/5</p>
<p><code>fullscreen</code> Tile covering the full screen</p>
<p><code>tile_random</code> Tile in a random location</p>
<p><code>tile_rand</code> Tile in a random location</p>
<p><code>sparkle</code> Small tile in a random location</p>
<p><code>droplet</code> Small tile in a random location, then falling down the screen</p>
<p><code>spark</code> Small tile flying outwards</p>
<p><code>gravity</code> Accelrating motion downwards. Best combined with other values; eg <code>spark+gravity</code></p>
<p><code>firefly</code> Random motion like a flying insect</p>
<p><code>transparent</code> Predefined colour. Others: black, darkgray, gray, lightgray, white, red, orange, yellow, green, blue, indigo, violet, neonpink, neongreen</p>
<p><code>random</code> Random colour</p>
<p><code>rainbow</code> Colour changing through the rainbow</p>
<p><code>pad</code> Envelope types eg <code>envelope=pad</code>; also <code>full</code> and <code>simple</code></p>
<p><code>wow</code> Randomly but smoothly varying signal, good for simulating analog 'wow' pitch distortion; eg <code>addc=wow</code></p>
</div>
<h4 onclick="toggleAccordion('accordion-controls')">▶ Controls</h4>
<div id="accordion-controls" class="closed">
<p><code>slider{name:'Foo', min:-5, max:5, init:0}</code> Create a new slider control on the page, which can be used for live control of live coded expressions. The name uniquely identifies the slider. The min and max parameters default to 0 and 1. The value dynamically updates to reflect the current position of the slider control.</p>
</div>
<h4 onclick="toggleAccordion('accordion-functions')">▶ Functions</h4>
<div id="accordion-functions" class="closed">
<p><code>pitch{degree:1,sharp:1,octave:3,scale:minor}</code> Calculate a frequency in Hz for a scale degree on an octave, with possible sharpening/flattening.</p>
</div>
<h4 onclick="toggleAccordion('accordion-play-samples')">▶ Play Samples</h4>
<div id="accordion-play-samples" class="closed">
<p>
<code>a</code> Gameboy hihat<br/>
<code>A</code> Gameboy kick drum<br/>
<code>b</code> Noisy beep<br/>
<code>B</code> Short saw<br/>
<code>c</code> Voice/string<br/>
<code>C</code> Choral<br/>
<code>d</code> Woodblock<br/>
<code>D</code> Dirty snare<br/>
<code>e</code> Electronic Cowbell<br/>
<code>E</code> Ringing percussion<br/>
<code>f</code> Pops<br/>
<code>F</code> Trumpet stabs<br/>
<code>g</code> Ominous<br/>
<code>G</code> Ambient stabs<br/>
<code>h</code> Finger snaps<br/>
<code>H</code> Clap<br/>
<code>i</code> Jungle snare<br/>
<code>I</code> Rock snare<br/>
<code>j</code> Whines<br/>
<code>J</code> Ambient stabs<br/>
<code>k</code> Wood shaker<br/>
<code>K</code> Percussive hits<br/>
<code>l</code> Robot noise<br/>
<code>L</code> Noisy percussive hits<br/>
<code>m</code> 808 toms<br/>
<code>M</code> Acoustic toms<br/>
<code>n</code> Noise<br/>
<code>N</code> Gameboy SFX<br/>
<code>o</code> Snare drum<br/>
<code>O</code> Heavy snare<br/>
<code>p</code> Tabla<br/>
<code>P</code> Tabla long<br/>
<code>q</code> Ambient stabs<br/>
<code>Q</code> Electronic stabs<br/>
<code>r</code> Metal<br/>
<code>R</code> Metallic<br/>
<code>s</code> Shaker<br/>
<code>S</code> Tamborine<br/>
<code>t</code> Rimshot<br/>
<code>T</code> Cowbell<br/>
<code>u</code> Soft snare<br/>
<code>U</code> Misc. Fx<br/>
<code>v</code> Soft kick<br/>
<code>V</code> Hard kick<br/>
<code>w</code> Dub hits<br/>
<code>W</code> Distorted<br/>
<code>x</code> Bass drum<br/>
<code>X</code> Heavy kick<br/>
<code>y</code> Percussive hits<br/>
<code>Y</code> High buzz<br/>
<code>z</code> Scratch<br/>
<code>Z</code> Loud stabs<br/>
<code>-</code> Hi hat closed<br/>
<code>|</code> Hangdrum<br/>
<code>=</code> Hi hat open<br/>
<code>/</code> Reverse sounds<br/>
<code>*</code> Clap<br/>
<code>\</code> Lazer<br/>
<code>~</code> Ride cymbal<br/>
<code>%</code> Noise bursts<br/>
<code>$</code> Beatbox<br/>
<code>#</code> Crash<br/>
<code>!</code> Yeah!<br/>
<code>+</code> Clicks<br/>
<code>&amp;</code> Chime<br/>
<code>@</code> Gameboy noise<br/>
<code>:</code> Hi-hats<br/>
<code>1</code> Vocals (One)<br/>
<code>2</code> Vocals (Two)<br/>
<code>3</code> Vocals (Three)<br/>
<code>4</code> Vocals (Four)<br/>
</p>
</div>
<p>Please report bugs, problems, issues and suggestions on <a href="https://github.com/sdclibbery/limut/issues" target="_blank">https://github.com/sdclibbery/limut/issues</a></p>
<canvas id="text-canvas" style="display: none;"></canvas>
</body>
<script data-main="main" src="require.js">
/*
====
==== audio ====
Allow adding filters in the room/echo loops eg echo=3/4{lpf:523} - but dont use existing filter handlers as must be per event only!
envelope exp (exponent) subparam, eg att={1/2,exp:2} ?? Or name it 'pow'?
Can specify media stream device
 Print list of all devices with IDs
 device param to specify required device ID to be used - need to store one stream per device
 Same for webcam
Sample synth has start param and uses sus param for duration
portamento
Add some more waveforms  https://github.com/GoogleChromeLabs/web-audio-samples/tree/main/archive/demos/wave-tables
808 synth based on https://github.com/vincentriemer/io-808
 ?? Or custom percussion synths
echo={1/2,pingpong:1} for stereo ping pong echo; use splitter and merger
Flanger
Make noise into a waveform not a worklet?  https://github.com/GoogleChromeLabs/web-audio-samples/blob/main/archive/demos/wave-tables/04_Noise
 And so use wave synth instead?
Convert pwm and ?noise to webassembly, performance is terrible compared to native oscs
Reverb gate: room={1,gate:1/4}
Multiple unnecessary gain nodes even from default effects chain (that has no effects)
this.freq should also respond to addc
Envelope follower? Pitch follower? for external synth
choke param for play synth to choke one sound off when the next plays (eg hihats)
Env=reverse (slow attack / fast release)
formant/vowel effects for vocal aaa/ooo/choir effects
Is it possible to control rate per frame?
fmpluck
 test fm 070604_[21], att=0, dur=1/2, echo=0, oct=4, amp=1, op1target='out', op1ratio=1, op2target=1, op2ratio=1, op2depth=1024, op2att=0, op2rel=8, op3target=1, op3ratio=2, op3depth=768, op3att=0, op3rel=8, op4target=1, op4ratio=3, op4depth=3072, op4att=0, op4rel=1/4, op4wave='sawtooth'
Is play rate per frame?
Allow setting main reverb room size
Look into improving quality of samples playing at slow rates?
AudioWorklet freeverb with webassembly
Drive should be per frame
Constant envelope type to allow specifying per frame envelope with amp?
reverb param allowing to use a convolution reverb with specified duration (at users own risk :-)
Pluck/guitar synths
 https://fazli.sapuan.org/blog/electric-guitar-synth-in-html5/
 https://github.com/ronkot/ks-guitar-synth/blob/master/src/js/guitar-string.js
 https://github.com/mohayonao/pluck-string-node/blob/master/index.js
Nice gentle pads
FM krunchy bass - https://www.youtube.com/watch?v=1XbrTC0NndM
'X' doesn't work on mobile??
Preload samples immediately after parsing
'add' param for play synth?
AudioWorklet FM operator supporting feedback with webassembly
speech synth
echoey space synth preset
 s ethereal 0<553342>7, vib=3, att=0, sus=2, rel=2, phaser=1/4, echo=(3,4), oct=5
soprano synth - use vib effect - aaah synth: https://github.com/AppGeo/web-audio-examples/blob/master/formant.html
support -ve rate for reverse playback
Normal bass synth
FM ambient synth - https://www.youtube.com/watch?v=_xL3qr-9-ZE
FM wood synth - https://www.youtube.com/watch?v=dXo_493fEpU
====
==== visual ====
video synth (use video element to load video file; don't try and target eg youtube)
 can play audio through external audio synth??
Nice shader idea? https://tanck.nl/wallpaper/
Can set texture repeat for text and image synths?
Spiral and noise and shimmer predistortions
Fan subparam for mirror  Eg mirror={6,fan:1/32}  Each mirror 'segment' is rotated by 1/32 more than the last
Possible nice shader https://twitter.com/zozuar/status/1438117355746377728?s=03
Hue,hsl functions (or just more fields on colours eg {h:1/3,l:1/2} ?)
Colour parsing should assume alpha of 1 for eg #fff and #ffffff
Consider pushing data of each event into a texture so a shader could display all events, eg as 2D patterns or voxels or 3D shapes
Disco glowing geometric shapes shader
Starfield shader
Check image.shadertoy, webcam etc etc for per frame alloc
make vignette work with window
vmirror?
Drop canvas to half res if gl frame rate is low? - Reduce canvas width and height to do this - need smoothing/hysteresis
Some form of anti aliasing eg for grid shader in perspective distance?
Add rotate to loc
 Handle: aspect ratio, off centre x/y, window
Start image download on parse not on first use
Support echo for visuals? Additive but dimmed, time turned back? Move down??
gamma
noise/film grain
pixellate per frame
Sprites duration should include rel? Or not??
shadertoy synth support textures - MtGSzh
 NO CORS!! https://www.shadertoy.com/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png
shadertoy synth multiple channels
====
==== things to test/consider ====
pattern features (), [], <>, #b, ^v, !=
p ping 0, add=[0,1,2,3]
(), follow, complex durs, delay, overrides
[], []t, []l/s, []e, []n, []r
operators + - * / ^ %
var, player.var, var{params}
modifiers {seed,per,0:0}, @e, @f
subparams {2,mix:1/2}
====
==== other ====
Embedded values should use the original b/count, not modified
 eg add=[[0,2,4,7]t4]r{seed:0,per:4,0:0}
 Rewrite the way time modifiers works
  It shouldn't statefully change the value of b/ev
   Instead it should provide the override time data to eval-params via the evalRecurse call it makes
    Then eval-params should apply the modification just for the one level of call
Can modify params; eg 'set bass amp += 1/2'
 Overrides should only modify when explicitly asked; so set b add=1 replaces the add param, it does not add an additional 1 to it
 Can use for follow players, set, and indeed within a player; eg: p ping 0, amp=2/3, ..., amp*=2
 Need to handle sub params
  Eg   set p1 vib+=1   !Doesn't affect vib depth;   set p1 vib.depth+=0.5   !Doesn't affect vib value or vib delay
Presets? Allow to define new synths; eg 'preset mysaw saw, att=0.02, lpf=this.freq*[5,3,2,1,1/2]e' then use mysaw as a synth
Better syntax highlighting for {} brackets; maybe bracket match highlighting??
Can specify params for all players except those in group 'set !bass amp=0' 'set ![kd,sd] amp=0'
Wildcard player matching for groups 'set d? amp=0'  'set p* amp=0'
? rl, rt (==r), rs (==n); el (==e), es, et ?
 ?[1,3,5]n syntax to smoothly transition between randomly chosen values or should be [1,3,5]rs?
 []w for random walk?
[]e4 to start on the event but run for 4 beats irrespective of how long the event actually lasts
Modifier or function that smooths the value over time, separate attach and decay rates if possible
Ability to set the pattern used on a player
 param: p play x:, pattern='X-O-'
Should delayed notes eval per event at the time of the delayed or undelayed event??
Proper tests for follow and overrides and combinations, including tuples
?? How to override a subparam without changing the main param (or other subparams)? Eg set lpf q without changing freq?
Follow player refactor
 Better follow tests
 Use stored events with a dependency
 Things to test:
  randoms (per event only)
    p1 ping 0, dur=1, amp=0.1, oct=4, add=[0:4]r
    v8 glow follow p1, loc={y:-1+this.add/2}, 
  complex durations (including random); EG:
    p1 ping 0, dur=[1]r, amp=0.1, oct=4
    v8 glow follow p1, loc=sparkle
  delays
 Clean up any unnecessary gumpf around getEventsForBeatBase etc
{offset} to apply an offset to the time counts
 Eg [0,1,2,3]t4{offset:1}
{step} to apply a step to the counts
 Eg [0:1000]l32{step:2} so the value onnly changes every 2 beats instead of smoothly
? env{att:0.1,dec:1/4,sus:1,suslevel:0.6,rel:} - sus should default to the actual note length of the event
 Use for eg: lpf=this.freq*50*env{att:0.02,dec:0.2,suslevel:0.1}
Fullscreen not working on safari
<player>.pulse should takes average of playing notes? To reduce sudden jumps when notes overlap?
[0,1]n should randomly choose one of 0 or one then smooth between them, [0:1]n should pick random values between 0 and 1...
 In which case, rewrite it as the main random, but then smoothed
floor function: delay=floor{[]r,to:1/4}
Complex durations cause beat drift ?? Round pattern count to smallest possible duration? Eg [1/2,1/3]r rounds to nearest 1/6
Per can default to repeat of thing being modified?
 Eg [0:1]l4{0:0} per defaults to 8?
Could use a syntax error on `set v.amp=0` (should be `set v amp=0`)
[]r{per:4} (ie without seed) ?? What should this do? Should it repeat? Or not?? Probably not??
Should Eg [0:1]e{per:1/4,1/2:-1} work??
stutter parameter??
Better error for eg  p ping _0
Sliders
 Exponential option
 Remember last value even when not shown
 Display slider value on UI, instead of logging
Support range overrides? Eg add=[0,1]l2{per:4,0-1:0}
[]w for random walk; eg [0:7]w random walk within 0 - 7 range; [0:7]w2{seed:1,per:8} etc; [0:7]w{step:2}
All randoms including []r and []n should be deterministic
 Need to seed with enough variation; player and time?
 Per frame random should then be synchronised in follow player
@e on var fails if the expression being looked up itself contains a var lookup
 Eg
  vf glow follow s, loc={x:(this.add@e/8)-1/2,y:0,w:1/2,h:1/2}
  s saw 0, dur=1/2, amp=1/4, add=[0:5]r{seed:0,per:8}+off
  off=0
  EG here, remove the "+off" and the glow moves correctly
Complex durs
 overrides - need to apply overrides earlier? Should apply to delay overrides too
 tuples
 var lookup (& player var lookup)
Swing param or pattern modifier
Ignore rests . when setting event.idx (so that `0.1., amp=[1/2,1]` does as expected) - is that expected? It wouldnt be for dur..?
Exponent exp modifier, eg [0:1]l{exp:1/2} to modify lerp shape
Can var lookup take the interval from the var interval?
 Need two pass parse??
  What about player var lookup then?
? Possible to additionally allow '=' as object key/value separator? Eg {r=1,g=2} etc ? Will this conflict with line/param parsing??
Maybe optimise per frame garbage in eval-params and eval-operators
multiline command fix: // should only comment out that one line
"on next 4 " / "on next 28 of 32 " syntax to execute a line on the next beat count
  - but how not to repeat this if rerun? replace now/next in source with actual count?
"every 4 " / "every 28 of 32 "
"until next 16 set [bass,kd] amp=0" ? - but how not to repeat this if rerun?
"by next 16 set bass amp=0" - lerps to the new value - but how not to repeat this if rerun?
pattern concat "xo + vi"
pattern repeat "xo * 3" higher precedence than concat
pattern support brackets "( xo + vi ) * 3"
pattern values in vars, and then use in multiple players, and also invert, retrograde etc
Pattern: should allow (024)^etc
Have a [0,1][2,3] syntax to apply values to multiple events in a row
Do not set delay, loud, sharp, long unless they have a value; even setting to undefined costs
WebMidi
 Outputs (to control external synths)
 Inputs (like sliders)
 Beat sync input?
Textarea editor keeps deleting contents after play
Need an additional eval interval; eg @i for 'per instance', so for each individual 'note' instance (each call to play)
 Useful for providing variation between (1,2,3,4) multiplied out sub-events without having to go full-on per frame, expecially for eg []r
Tutorials
 ? Can automate the copy to clipboard paraphernalia?
 Link on this page
 Link on README
Can't override dur from set command
multiline command fix: do not insert ' ' into split strings
can set seed for noise
 use to fix firefly properly
can set seed for random
if do amp=p1.amp, and p1 doesn't explicitly set its amp, you get zeroes...
value param to override the pattern value
pattern "(01)": idx should be 0 for both events, surely?
 event.idx (supposed to be the index of the event through the pattern) is incorrect when there's a () chord
how to enable random chord same for all players: ch=[0:4]r ..?
 ? could [0:4]r1 be made to do it?
syntax coloring: colour for patterns
Allow variable durations eg [0:1]l(3+[1:2]t4) etc
[]te, []le, []se etc syntax to start from event start time?
Support [0,1,2]e[0,.1,1] syntax
commenting out in patterns doesnt work eg 'pi ping 0 //(024)(035)'
extending patterns like every/sometimes/offadd/stutter etc
Can support double quotes for strings??
dur=[1,2,3,4]r
maybe []i for int random?
finish off: <> for 'in sequence on each repeat' in patterns
Should be able to [red:blue]l8
should multiply out 'chords' in objects eg loc={x:(0,1,2,3), y:(0,1,2,3), w:1,h:1}/4
_ extends all notes properly, even across brackets (eg <1[.3]>_ etc)
<> for 'in sequence on each repeat' in params
rests in params
random in patterns: what syntax??
sliders that appear in the code as vars
popup keyboard triggered by pattern eg "p piano keyboard"
seeded random: takes repeat length and optional seed
^ operator: concat arrays
? What do nested [] mean in params?
allow dur to be tvar
?? Should param pattern repeat be independent of main pattern repeat? Eg so you can xo, amp=[1,2,3] and it multiplies out
fix delay param problems (commented tests in pattern.js)
index pattern by beat to improve performance in finding events - same for timeVar evaluation
pattern generators: tri, Dur, walk etc?
==
==== Glitching
glitching test case:
p dsaw 0, dur=1/170, sus=1, lpf=[1000:2000]l5@f, amp=1/8
v swirl 0, rate=5, fore=rainbow_fast
Think we need to minimise/reduce per beat allocation too; audit all code :-/
===
===== Interesting shadertoys
-- working
Nixie digits: 4dc3zr
swirl shader 4dX3Rn
scaly shader MdSXzz
bubbles shader 4dl3zn
Fractal: MlGfDG
Fractal zoom: XtlGR2
Fractal tiling: Ml2GWy
3d supershape: 4llGWM
glitchy space patrol: ltlGD8
vector field: MdcyRs
Star tunnel: MdlXWr
dusty nebula: lslyRn
smoke lights: MdyGzR
laser show: MdjyzG
smoke laser: 3lSGDK
nebula smoke: 4ltSRS
disco tunnel: XstfzB
disco balls: lllXWr
sky swoop: lldSWN
Flux core: ltlSWf
candy core: 4sVXDz
core engine: Wsc3W4
warp core: 4lGXzG
80s synthwave: 4t33D2
-- needs textures
synthwave driving shader tsScRK
power sphere MtGSzh
furry shader 4dlGDN
gem tunnel shader ld3Szs
-- needs channels
forge shader based on: llK3Dy
-- extensions
Mechanical: XslXW2
-- shader not found (not published with 'public+api' option)
Raindrops: https://www.shadertoy.com/view/tlVGWK
plant wind https://www.shadertoy.com/view/4lf3Rj
star shader https://www.shadertoy.com/view/4dXGR4
plasma ball https://www.shadertoy.com/view/XsjXRm
Galaxy: https://www.shadertoy.com/view/llSGR1
electric shader https://www.shadertoy.com/view/ldlXRS
lattice shader   https://www.shadertoy.com/view/4dsGD7
fireball shader https://www.shadertoy.com/view/lsf3RH
Space: https://www.shadertoy.com/view/lslSDS
Spiral flow: https://www.shadertoy.com/view/MdlXRS
Fractal https://www.shadertoy.com/view/lslGWr
Colour tunnel: https://www.shadertoy.com/view/XdSGzR
Cell flow: https://www.shadertoy.com/view/MlsGWX
=== Images
icon='https://upload.wikimedia.org/wikipedia/commons/0/04/Radiation_diamond.svg'
drums='https://upload.wikimedia.org/wikipedia/commons/0/0b/Radioactive_keeper_drums.JPG'
sign='https://upload.wikimedia.org/wikipedia/commons/7/7d/Trinity_007.jpg'
spider='https://upload.wikimedia.org/wikipedia/commons/2/26/Jumping_Spider.jpg'
cleanup='https://upload.wikimedia.org/wikipedia/commons/4/40/IAEA_02790019_%285613119300%29.jpg'
---
test fm 020406[79]5, oct=5, att=1/16, \
  op1={target:'out',ratio:1}, \
  op2={target:1, 		ratio:1, depth:128, att:0, rel:8}, \
  op3={target:'out',ratio:2, depth:512, att:0, rel:2}, \
  op4={target:3,    ratio:2.02, depth:256, att:1/4, rel:2}, \
  op5={target:'out',ratio:1, depth:512, att:1/16, rel:1/4}, \
  op6={target:5,    ratio:1, depth:1024, att:0, rel:1/4},
*/
</script>
</html>
